<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Skrip Video Kompleks Kocak</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <div class="container mx-auto max-w-4xl p-4 sm:p-6 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-indigo-600 dark:text-indigo-400">Generator Skrip Video Kocak .AI</h1>
            <p class="mt-2 text-lg text-gray-600 dark:text-gray-400">Bikin skrip video paling gokil dari ko pu kompleks!</p>
        </header>

        <main>
            <!-- Input Form -->
            <div id="form-container" class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg transition-all duration-300">
                <form id="story-form">
                    <!-- Character Inputs -->
                    <div class="mb-6">
                        <label class="block text-lg font-semibold mb-3 text-gray-700 dark:text-gray-300">Pemain di Kompleks</label>
                        <div id="character-inputs" class="space-y-3">
                            <!-- Initial character input -->
                            <div class="flex items-center space-x-2">
                                <input type="text" name="character" class="character-input w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition" placeholder="Contoh: Pace Yoris si tukang palak">
                                <button type="button" class="remove-character-btn hidden text-red-500 hover:text-red-700 dark:hover:text-red-400 transition-colors">&times;</button>
                            </div>
                        </div>
                        <button type="button" id="add-character-btn" class="mt-3 text-sm font-medium text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 transition-colors">+ Tambah Pemain</button>
                    </div>

                    <!-- Genre Selection -->
                    <div class="mb-6">
                        <label for="genre" class="block text-lg font-semibold mb-3 text-gray-700 dark:text-gray-300">Pilih Model Cerita Kocak</label>
                        <select id="genre" class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition">
                            <option value="Drama Kompleks">Drama Kompleks</option>
                            <option value="Salah Paham">Salah Paham</option>
                            <option value="Acara 17-an Kacau">Acara 17-an Kacau</option>
                            <option value="Mop Lucu">Mop Lucu</option>
                            <option value="Horor Komedi">Horor Komedi</option>
                            <option value="Rebutan Warisan">Rebutan Warisan</option>
                        </select>
                    </div>

                    <!-- Synopsis Input -->
                    <div class="mb-6">
                        <label for="synopsis" class="block text-lg font-semibold mb-3 text-gray-700 dark:text-gray-300">Ide Cerita (Bibit Masalah)</label>
                        <textarea id="synopsis" rows="5" class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition" placeholder="Contoh: Ayam jago kesayangan milik ketua RT hilang, semua warga saling tuduh sampai baku pukul. Ternyata ayamnya cuma pergi cari betina di kompleks sebelah."></textarea>
                    </div>
                    
                    <!-- Generate Button -->
                    <div class="text-center">
                        <button type="submit" id="generate-btn" class="w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300">
                            Bikin Rusuh!
                        </button>
                    </div>
                </form>
            </div>

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="hidden text-center my-10">
                <div class="inline-flex items-center space-x-3">
                    <svg class="animate-spin h-8 w-8 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="text-lg font-medium text-gray-600 dark:text-gray-400">AI lagi godok skrip... Tunggu dulu e!</span>
                </div>
            </div>
            
            <!-- Result Display -->
            <div id="result-container" class="hidden mt-10 bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-xl shadow-lg fade-in">
                <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-center text-indigo-600 dark:text-indigo-400">Ini Dia Ko Pu Skrip!</h2>
                <div id="story-output" class="prose prose-lg dark:prose-invert max-w-none text-justify leading-relaxed whitespace-pre-wrap">
                    <!-- Generated script will appear here -->
                </div>
                <div class="mt-8 flex flex-col sm:flex-row justify-center items-center gap-4">
                    <button id="copy-btn" class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition-all duration-300">Salin Skrip</button>
                    <!-- New Download PDF Button -->
                    <button id="download-btn" class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-all duration-300">Unduh PDF</button>
                    <button id="reset-btn" class="w-full sm:w-auto bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg transition-all duration-300">Bikin Lagi!</button>
                </div>
                <div id="copy-feedback" class="text-center mt-3 text-green-600 dark:text-green-400 font-medium hidden">Skrip berhasil disalin!</div>
            </div>

            <!-- Error Message Box -->
            <div id="error-box" class="hidden mt-6 bg-red-100 dark:bg-red-900/30 border border-red-400 dark:border-red-500 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg relative" role="alert">
                <strong class="font-bold">Aduh!</strong>
                <span id="error-message" class="block sm:inline"></span>
            </div>

        </main>
    </div>

    <script type="module">
        // --- Global namespace for jsPDF ---
        const { jsPDF } = window.jspdf;

        // --- DOM Element Selection ---
        const storyForm = document.getElementById('story-form');
        const characterInputsContainer = document.getElementById('character-inputs');
        const addCharacterBtn = document.getElementById('add-character-btn');
        const genreSelect = document.getElementById('genre');
        const synopsisInput = document.getElementById('synopsis');
        const generateBtn = document.getElementById('generate-btn');
        const loadingIndicator = document.getElementById('loading-indicator');
        const resultContainer = document.getElementById('result-container');
        const storyOutput = document.getElementById('story-output');
        const copyBtn = document.getElementById('copy-btn');
        const downloadBtn = document.getElementById('download-btn'); // New button
        const resetBtn = document.getElementById('reset-btn');
        const copyFeedback = document.getElementById('copy-feedback');
        const errorBox = document.getElementById('error-box');
        const errorMessage = document.getElementById('error-message');
        const formContainer = document.getElementById('form-container');

        // --- Event Listeners ---
        addCharacterBtn.addEventListener('click', addCharacterField);
        characterInputsContainer.addEventListener('click', (e) => {
            if (e.target && e.target.classList.contains('remove-character-btn')) {
                e.target.parentElement.remove();
                updateRemoveButtons();
            }
        });
        storyForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            await generateStory();
        });
        copyBtn.addEventListener('click', copyStoryToClipboard);
        downloadBtn.addEventListener('click', downloadAsPDF); // New listener
        resetBtn.addEventListener('click', resetForm);

        // --- Functions ---
        function addCharacterField() {
            const div = document.createElement('div');
            div.className = 'flex items-center space-x-2 fade-in';
            div.innerHTML = `
                <input type="text" name="character" class="character-input w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition" placeholder="Pemain lainnya">
                <button type="button" class="remove-character-btn text-red-500 hover:text-red-700 dark:hover:text-red-400 transition-colors text-2xl font-bold leading-none">&times;</button>
            `;
            characterInputsContainer.appendChild(div);
            updateRemoveButtons();
        }

        function updateRemoveButtons() {
            const allRemoveButtons = document.querySelectorAll('.remove-character-btn');
            allRemoveButtons.forEach((btn, index) => {
                btn.classList.toggle('hidden', allRemoveButtons.length === 1);
            });
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorBox.classList.remove('hidden');
            setTimeout(() => {
                errorBox.classList.add('hidden');
            }, 5000);
        }

        async function generateStory() {
            hideError();
            const characterInputs = document.querySelectorAll('.character-input');
            const characters = Array.from(characterInputs)
                .map(input => input.value.trim())
                .filter(name => name !== '');

            const synopsis = synopsisInput.value.trim();
            const genre = genreSelect.value;

            if (characters.length === 0) {
                showError('Isi dulu nama pemainnya, bos.');
                return;
            }
            if (synopsis === '') {
                showError('Kasih bibit masalahnya dulu, baru kita bikin ribut.');
                return;
            }

            formContainer.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            generateBtn.disabled = true;
            generateBtn.textContent = 'Sabar e...';

            const prompt = `
                Anda adalah seorang penulis skenario video pendek komedi yang sangat mahir dalam budaya dan bahasa gaul Papua. Latar ceritanya adalah sebuah kompleks perumahan yang selalu heboh dan penuh masalah lucu.

                **TUGAS UTAMA:** Buat sebuah SKRIP VIDEO PENDEK (durasi sekitar 1-3 menit) yang SANGAT KOCAK, KONYOL, dan 'KOMPLEKS'. Fokus pada situasi lucu, salah paham, dialog yang bikin tertawa, dan karakter yang unik.

                **WAJIB:** Gunakan gaya bahasa dan logat khas Papua secara total (sapaan "pace", "mace", kata "sa", "ko", "dong", "tra", "bikin", "ioo", "awaskoo", dll).

                **FORMAT SKRIP (HARUS DIIKUTI):**
                -   **JUDUL SKRIP:** (Buatkan judul yang paling gokil dan provokatif)
                -   **SCENE HEADING:** Tulis dengan format: INT./EXT. NAMA LOKASI - WAKTU (PAGI/SIANG/MALAM). Contoh: EXT. DEPAN RUMAH PAK RT - SIANG.
                -   **DESKRIPSI AKSI:** Jelaskan apa yang terjadi di scene itu dengan singkat.
                -   **NAMA KARAKTER:** Tulis di tengah dengan huruf kapital.
                -   **DIALOG:** Tulis di bawah nama karakter.
                -   **EKSPRESI/AKSI KECIL:** Tulis (dalam kurung) di bawah nama karakter jika perlu.

                ---
                **INFORMASI DARI PENGGUNA:**

                **Genre Komedi:** ${genre}

                **Pemain Utama:** ${characters.join(', ')}

                **Bibit Masalah (Sinopsis):**
                ${synopsis}
                ---

                **CONTOH FORMAT:**

                **JUDUL: AYAM JAGO BIKIN PUSING**

                **SCENE 1**

                EXT. HALAMAN RUMAH PAK RT - PAGI

                PACE YORIS (salah satu pemain) lari-lari sambil berteriak panik. MACE AGNES (pemain lain) sedang siram bunga, kaget sampai selang air terlepas.

                PACE YORIS
                Aduhh! Mace! Gawat ini! Gawat!

                MACE AGNES
                (sambil pegang dada)
                Heh! Ko bikin sa jantungan saja! Ada apa kah?!

                ---
                **Mulai skrip Anda di bawah ini berdasarkan informasi pengguna.**
            `;

            try {
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("API Error:", errorData);
                    throw new Error(`API request failed with status ${response.status}. ${errorData.error?.message || ''}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    
                    const generatedText = result.candidates[0].content.parts[0].text;
                    storyOutput.textContent = generatedText;
                    
                    loadingIndicator.classList.add('hidden');
                    resultContainer.classList.remove('hidden');

                } else {
                    console.error("Invalid AI Response:", result);
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].finishReason) {
                         throw new Error(`Skrip tra bisa dibuat. Alasan: ${result.candidates[0].finishReason}`);
                    }
                    throw new Error("Respon dari AI kosong, mungkin dia lagi pusing.");
                }

            } catch (error) {
                console.error('Error generating story:', error);
                showError(`Ada masalah: ${error.message}. Coba lagi nanti.`);
                loadingIndicator.classList.add('hidden');
                formContainer.classList.remove('hidden');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'Bikin Rusuh!';
            }
        }
        
        function hideError() {
            errorBox.classList.add('hidden');
        }

        function copyStoryToClipboard() {
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = storyOutput.textContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            copyFeedback.textContent = 'Skrip berhasil disalin!';
            copyFeedback.classList.remove('hidden');
            setTimeout(() => {
                copyFeedback.classList.add('hidden');
            }, 2000);
        }

        /**
         * New function to download the script as a PDF file.
         */
        function downloadAsPDF() {
            const doc = new jsPDF();
            const scriptText = storyOutput.textContent;
            
            // Define margins and line height
            const margin = 15;
            const lineHeight = 7;
            const pageHeight = doc.internal.pageSize.getHeight();
            const pageWidth = doc.internal.pageSize.getWidth();
            let y = margin; // Initial y position

            // Set font size
            doc.setFontSize(12);

            // Split the text into lines that fit the page width
            const lines = doc.splitTextToSize(scriptText, pageWidth - margin * 2);

            // Process each line
            lines.forEach(line => {
                // Check if there is enough space for the next line
                if (y + lineHeight > pageHeight - margin) {
                    doc.addPage(); // Add a new page
                    y = margin; // Reset y position
                }

                // Add text to the PDF
                doc.text(line, margin, y);
                y += lineHeight; // Move to the next line
            });

            // Save the PDF
            doc.save('skrip-kocak.pdf');
        }

        function resetForm() {
            resultContainer.classList.add('hidden');
            formContainer.classList.remove('hidden');
            storyForm.reset();
            storyOutput.textContent = '';
            
            const extraFields = document.querySelectorAll('#character-inputs .flex:not(:first-child)');
            extraFields.forEach(field => field.remove());
            updateRemoveButtons();
            hideError();
        }

        updateRemoveButtons();
    </script>
</body>
</html>
